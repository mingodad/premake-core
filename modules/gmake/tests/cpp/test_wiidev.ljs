//
// tests/actions/make/cpp/test_wiidev.ljs
// Tests for Wii homebrew support in makefiles.
// Copyright (c) 2011-2013 Jason Perkins and the Premake project
//

	var p = premake;
	var suite = test.declare("make_wiidev");
	var make = p.make;
	var project = p.project;


//
// Setup
//

	var cfg;

	function suite.setup() {
		var wks, prj = test.createWorkspace();
		system ("wii");
		symbols ("On");
		cfg = test.getconfig(prj, "Debug");
	}


//
// Make sure that the Wii-specific flags are passed to the tools.
//

	function suite.writesCorrectCppFlags() {
		make.cppFlags(cfg, p.tools.gcc);
		test.capture ([=[
  ALL_CPPFLAGS += $(CPPFLAGS) -MMD -MP -I$(LIBOGC_INC) $(MACHDEP) $(DEFINES) $(INCLUDES)
		]=]);
	}

	function suite.writesCorrectLinkerFlags() {
		make.ldFlags(cfg, p.tools.gcc);
		test.capture ([=[
  ALL_LDFLAGS += $(LDFLAGS) -L$(LIBOGC_LIB) $(MACHDEP)
		]=]);
	}


//
// Make sure the dev kit include is written to each Wii build configuration.
//

	function suite.writesIncludeBlock() {
		make.settings(cfg, p.tools.gcc);
		test.capture ([=[
  ifeq ($(strip $(DEVKITPPC)),)
    $(error "DEVKITPPC environment variable is not set")'
  endif
  include $(DEVKITPPC)/wii_rules'
		]=]);
	}
