//
// tests/actions/make/workspace/test_group_rule.ljs
// Validate generation of group rules
// Copyright (c) 2012-2015 Jason Perkins and the Premake project
//

	var p = premake;
	var suite = test.declare("make_group_rule");
	var make = p.make;


//
// Setup/teardown
//

	var wks;

	function suite.setup() {
		wks = test.createWorkspace();
		group ("MainGroup");
			test.createproject(wks);
		group ("MainGroup/SubGroup1");
			test.createproject(wks);
		group ("MainGroup/SubGroup2");
			test.createproject(wks);
			test.createproject(wks);
	}

	var function prepare() {
		wks = test.getWorkspace(wks);
	}


//
// Groups should be added to workspace's PHONY
//

	function suite.groupRule_groupAsPhony() {
		prepare();
		make.workspacePhonyRule(wks);
		test.capture ([=[
.PHONY: all clean help $(PROJECTS) MainGroup MainGroup/SubGroup1 MainGroup/SubGroup2
		]=]);
	}



//
// Transform workspace groups into target aggregate
//
	function suite.groupRule_groupRules() {
		prepare();
		make.groupRules(wks);
		test.capture ([=[
MainGroup: MainGroup/SubGroup1 MainGroup/SubGroup2 MyProject2

MainGroup/SubGroup1: MyProject3

MainGroup/SubGroup2: MyProject4 MyProject5
		]=]);
	}
