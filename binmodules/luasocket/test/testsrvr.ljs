socket = require("socket");
host = host || "localhost";
port = port || "8383";
server = assert(socket.bind(host, port));
ack = "\n";
while( 1 ) {
    print("server: waiting for client connection...");
    control = assert(server->accept());
    while( 1 ) {
        command, emsg = control->receive();
        if( emsg == "closed" ) {
            control->close();
            break;
        }
        assert(command, emsg);
        assert(control->send(ack));
        print(command);
		((loadstring || load)(command))();
    }
}
